<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Buton Paneli</title>
<style>
  html, body {
    width: 100%;
    height: 100%;
    margin: 0;
  }

  body {
    background-color: #202020;
    font-family: Arial, sans-serif;
    color: #eee;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #panel {
    width: 100%;
    height: 100%;
    background-color: #2b2b2b;
    border: 1px solid #555;
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
  }

  /* Ãœst ve orta buton gruplarÄ± */
  #topGroups {
    display: flex;
    gap: 10px;
    flex: 1 1 auto; /* kalan alanÄ± kaplasÄ±n */
    align-items: stretch;
  }

  .group {
    flex: 1;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: center;
    align-content: stretch;
  }

#birimGroup {
  display: grid;
  grid-template-columns: repeat(2, 1fr); /* 2 sÃ¼tun */
  gap: 6px;
}

#birimGroup button {  /* Ã¶zel olarak grid yapÄ±ldÄ±ÄŸÄ± iÃ§in yani flex deÄŸil artÄ±k, alttaki genel buton kodu iÅŸlemez */
  width: 100%; 
  height: 100%; 
  flex: none;    /* olasÄ± miras etkilerini kaldÄ±rÄ±r */
}

  #orangeGroup {
    margin-top: 10px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: center;
    flex: 1 1 auto; /* otomatik bÃ¼yÃ¼sÃ¼n */
    align-content: stretch;
  }

  /* Genel buton stili */
  button {
    flex: 1 1 auto;  /* butonlar satÄ±r yÃ¼ksekliÄŸine uyumlu */
    min-width: 50px;
    padding: 6px;
    border: none;
    border-radius: 8px;
    color: #f0f0f0;
    cursor: pointer;
    font-weight: bold;
    background-color: #3b3b3b;
    transition: background-color 0.15s, transform 0.1s;
	font-size: 22px;
  }

  button:hover {
    transform: scale(1.05);
  }

  /* Mat buton renkleri */
  .gray  { background-color: #656666; }
  .gray:hover  { background-color: #9a9b9c; }

  .green { background-color: #3f5a47; }
  .green:hover { background-color: #4f6a56; }

  .brown { background-color: #63472e; }
  .brown:hover { background-color: #826851; }

  .blueBt { background-color: #395e6b; }
  .blueBt:hover { background-color: #5a8899; }

  .orangeBtn { background-color: #6c4b2e; }
  .orangeBtn:hover { background-color: #7a5b3a; }
  
  .hazirDoz { background-color: #517d06; }
  .hazirDoz:hover { background-color: #73ab13; }

  /* Alt bÃ¶lÃ¼m */
  #bottom {
    display: flex;
    margin-top: 10px;
    gap: 6px;
    flex: 0 0 auto; /* sabit yÃ¼ksekliÄŸe uyumlu */
  }

  textarea {
    height: 200px; 
    width: 100%;
    background-color: #1c1c1c;
    color: #fff;
    border: 1px solid #555;
    border-radius: 8px;
    padding: 6px;
    resize: none;
    font-size: 14px;
    box-sizing: border-box;
  }

  #sideButtons {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  #sideButtons button {
    padding: 8px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    color: white;
    font-weight: bold;
    flex: 1 1 auto;
  }

  #copy { background-color: #65686e; }
  #back { background-color: #65686e; }
  #del  { background-color: #6a4040; }
  #sent { background-color: #40506a; }

  #sideButtons button:hover {
    opacity: 0.85;
  }
</style>
</head>
<body>

<div id="panel">
  <div id="topGroups">
    <div class="group" id="grayGroup"></div>
	<div class="group" id="birimGroup"></div>
    <div class="group" id="greenGroup"></div>
    <div class="group" id="brownGroup"></div>
  </div>

  <div id="orangeGroup"></div>

  <div id="bottom">
    <textarea id="ta_medi"></textarea>
    <div id="sideButtons">
      <button id="copy">Copy</button>
      <button id="back">Back</button>
      <button id="del">Del</button>
      <button id="sent">Add</button>
    </div>
  </div>
</div>

<script>
const ta = document.getElementById("ta_medi");

/* --- Buton gruplarÄ± --- */
const hazirDoz = [
  "avil","beloc","contramal","desal","diazem","diltizem","kapril", "keppra",
  "depakin","fenitoin","krs.insÃ¼lin","metpamid","pantpas","perlinganit",
  "ventolin","zofran"
];

const buttons = {
  gray:  ["1","2","3","4","5","7","10","12","15","100","250","300","500","1000","2000"],
  birim: ["amp","U","mg","cc","gr"],
  green: ["SF","%5 Dx","%3","0,45"],
  brown: ["IM","IV","inf","puÅŸe", "inh","PO","+",","],
  orange: [
    "combivent","cordarone","coraspirin","decort","dormicum","esmelol",
    "K-vit","tetanoz","NaHCO3",
    ...hazirDoz
  ].sort((a, b) => a.localeCompare(b, 'tr')) // ðŸ”¹ TÃ¼rkÃ§e alfabe sÄ±ralamasÄ±
};


const full_order = [
"1amp metpamid 100cc SF IV inf", "1amp diltizem 100cc SF IV 5dk inf", "1amp beloc 100cc SF IV 15dk inf", "1mp perlinganit 100cc SF (4cc puÅŸe, 5cc/st IV inf)", "1amp pantpas IV puÅŸe", "10U krs.insÃ¼lin IV puÅŸe", "1amp ventolin inh", "1amp combivent inh", "1amp zofran IV puÅŸe", "1amp avil 100cc SF IV inf", "keppra 1500mg 250cc SF/1st", "depakin 2000mg 250cc SF/30dk", "fenitoin 1000mg 250cc SF/30dk", "1amp contramal 100cc SF IV inf", "1amp desal IV puÅŸe", "1amp/10mg diazem 100cc SF IV inf", "1amp/25mg diltizem 100cc SF IV 10dk inf", "Kapril 25mg dil altÄ±"
];

/* --- ButonlarÄ± oluÅŸtur --- */
Object.entries(buttons).forEach(([color, items]) => {
  const group = document.getElementById(color + "Group") || document.getElementById("orangeGroup");
  items.forEach(label => {
    const b = document.createElement("button");
    b.textContent = label;
    b.classList.add(color === "orange" ? "blueBt" : color);
	if (hazirDoz.includes(label)) b.classList.add("hazirDoz");


b.addEventListener("click", () => {
  const val = ta.value.trim();

  // --- ORANGE grubu Ã¶zel davranÄ±ÅŸÄ± ---
  if (color === "orange") {
    // EÄŸer textarea boÅŸ ya da virgÃ¼l ile bitiyorsa
    if (!val || val.endsWith(",")) {
      const match = full_order.find(f => f.toLowerCase().includes(label.toLowerCase()));
      if (match) {
        // BaÅŸÄ±na fazladan virgÃ¼l koymadan ekle
        ta.value = ta.value.trimEnd();
        if (ta.value && !ta.value.endsWith(",")) ta.value += ",";
        ta.value += (ta.value ? " " : "") + match + ", ";
        return;
      }
    }
  }

  // --- DiÄŸer gruplarÄ±n varsayÄ±lan davranÄ±ÅŸÄ± ---
  if (color === "birim") {
    ta.value += label;
  } else {
    ta.value += (ta.value ? " " : "") + label;
  }
});

    group.appendChild(b);
  });
});

/* --- Alt butonlar --- */
document.getElementById("copy").addEventListener("click", () => {
  const val = ta.value;
  sessionStorage.setItem("med_tedavi", val);
  ta.select();
  document.execCommand("copy");
});

document.getElementById("del").addEventListener("click", () => {
  ta.value = "";
});

/* VirgÃ¼le kadar silme */
document.getElementById("back").addEventListener("click", () => {
  let val = ta.value.trim();
  if (!val) return;
  const lastComma = val.lastIndexOf(",");
  if (lastComma === -1) ta.value = "";
  else ta.value = val.substring(0, lastComma).trim();
});

document.getElementById("sent").addEventListener("click", () => {
	localStorage.setItem('med_tedavi', ta.value);
	localStorage.setItem('hideMedDiv', 'true');// iframe iÃ§inden, ana sayfadaki 'div' Ã¶ÄŸesini gizleme
        setTimeout(() => {
            //history.back(); // bir Ã¶nceki sayfaya gÃ¼venli geri dÃ¶nÃ¼ÅŸ
        }, 100); // kÃ¼Ã§Ã¼k gecikme ile localStorage'Ä±n kaydedilmesini garanti et
	 console.log("sent med.tedavi");
});
</script>

</body>
</html>
